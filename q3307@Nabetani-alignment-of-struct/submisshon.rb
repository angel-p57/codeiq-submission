p gets.chomp.chars.reduce(t=0){|s,c|s+=t;t,x=(d="CSIDM".index c)?[1<<d]*2:[8,4];-s%x+s}
